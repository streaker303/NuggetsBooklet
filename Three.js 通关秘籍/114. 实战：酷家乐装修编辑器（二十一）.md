上节把家具在 2D 视图画了出来。

并且 2D 视图编辑会同步 3D 视图：

![2025-07-02 14.33.27.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc561b7e35e640cebd5fa842751b0cc9~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=4586461&e=gif&f=37&b=e6f3fb)

3D 视图编辑会同步 2D 视图：

![2025-07-02 17.29.44.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e0795e5de1e47929a394a3acf48e587~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=1222821&e=gif&f=50&b=f3f3f3)

但我们需要分别切换 2D、3D 视图，不能同时看。

而在酷家乐里，3D 视图会在右上角展示 2D 视图：

![2025-07-02 20.13.18.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/478ad69a33e64137b641ee5b669e9b04~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=4686553&e=gif&f=46&b=f0f3f4)

2D 视图会在右上角展示 3D 视图：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b02c4ec61aed486daf69e343058387e2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2032&h=1266&s=742160&e=png&b=eff0f1)

我们也来实现这种交互。

其实也很简单，之前是切换显示隐藏，修改的是 display 样式：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f2eda4ee08b44669529794cb52c1cac~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1732&h=470&s=120893&e=png&b=1f1f1f)

现在改为修改宽高。

我们除了要改 div 的宽高外，还要改 threejs 渲染的 canvas 的宽高：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e84ddd6e0b5c474ca744c684eed81bed~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1566&h=882&s=271296&e=png&b=f7f7f7)

所以我们要在 threejs 初始化的时候暴露一个改变宽高的方法：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/44ec7c90a2054db18552d1530063f24d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1216&h=1342&s=216297&e=png&b=1f1f1f)

```javascript
function changeSize(isBig: boolean) {
    if(isBig) {
        const width = window.innerWidth;
        const height = window.innerHeight - 60;

        renderer.setSize(width,height);

        camera.aspect = width / height;
        camera.updateProjectionMatrix();
    } else {
        const width = 240;
        const height = 200;

        renderer.setSize(width,height);

        camera.aspect = width / height;
        camera.updateProjectionMatrix();
    }
}
```
就是如果 isBig 是 true 就把画布大小设置为窗口宽高，否则设置 240 * 200

把之前设置 display 的逻辑去掉：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f2eda4ee08b44669529794cb52c1cac~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1732&h=470&s=120893&e=png&b=1f1f1f)

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/289eda286600441f833f887721b204bc~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1372&h=394&s=87498&e=png&b=1f1f1f)

然后调用下 changeSize 方法：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1003f8c50ea8481cab3901aa1bf0f2c4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1552&h=1070&s=278241&e=png&b=1f1f1f)

```javascript
const changeSize3DRef = useRef<(isBig: boolean) => void>(null);
```
```javascript
changeSize3DRef.current = changeSize;
```
调用下：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5c464c8ffc64cd48749898a8325266a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1534&h=1044&s=191636&e=png&b=1f1f1f)

```javascript
useEffect(() => {
    const changeSize3D = changeSize3DRef.current!;

    changeSize3D(false);

}, []);
```
改了宽高还得改下样式：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f2934d859a3a4d3a942fced7ddb28e72~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=902&h=794&s=103676&e=png&b=1f1f1f)

```css
#threejs-3d-container {
    position: absolute;
    z-index: 2;
    right: 0;
}
#threejs-2d-container {
    position: absolute;
    z-index: 1;
    right: 0;
}
```
把 3D 的 z-index 改大点，然后 right 为 0，在右上角。


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f8224d553e54951ab26d6ebc9907da6~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2372&h=1502&s=598820&e=png&b=b1d8e6)

没啥问题。

canvas 宽高设置好了，div 没有设置宽高，会由内容撑开，所以也是一样的宽高：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5af8e93bcd28464bbe2c96d2617c2f7d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1422&h=702&s=251173&e=png&b=fefefe)


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67286e43fce24594bb78f547bf205d1c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1394&h=676&s=257457&e=png&b=fefefe)

所以我们只需要在点击按钮的时候，修改两个 canvas 的宽高就好了。

在 2D 的初始化代码里也加上这个方法：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72b71530ea344db4bc82f6c175858bf4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1124&h=1266&s=201316&e=png&b=1f1f1f)

```javascript
function changeSize(isBig: boolean) {
    if(isBig) {
        const width = window.innerWidth;
        const height = window.innerHeight - 60;

        renderer.setSize(width,height);

        camera.aspect = width / height;
        camera.updateProjectionMatrix();
    } else {
        const width = 240;
        const height = 200;

        renderer.setSize(width,height);

        camera.aspect = width / height;
        camera.updateProjectionMatrix();
    }
}
```
也同样接收一下：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68180cc425af45459f6a43a0b64dfb29~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1510&h=640&s=197318&e=png&b=1f1f1f)


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de76559d0e0540d6b4464c97247a7eeb~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1492&h=686&s=143289&e=png&b=1f1f1f)
```javascript
const changeSize2DRef = useRef<(isBig: boolean) => void>(null);
```
```javascript
changeSize2DRef.current = changeSize;
```

之前有一个状态记录了当前视图：



![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f699bfbfca94e3a9eb2b00e6d6d60b5~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1362&h=684&s=197558&e=png&b=1f1f1f)

把它提到上面来。

然后把设置 size 的移到最后，因为要等那两个场景初始化完才能拿到这俩方法：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/348780ef514f4747a1aa76a427489af4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1834&h=1102&s=254250&e=png&b=1f1f1f)

curMode 变化的时候，修改两个视图的 size，并且还要改下 index。

```javascript
useEffect(() => {
    const changeSize3D = changeSize3DRef.current!;
    const changeSize2D = changeSize2DRef.current!;

    if(curMode === '2d') {
        changeSize3D(false);
        changeSize2D(true);
    } else {
        changeSize3D(true);
        changeSize2D(false);
    }
}, [curMode]);
```
```javascript
<div id="threejs-3d-container" style={{ zIndex: curMode ==='2d' ? 2 : 1}}></div>
 <div id="threejs-2d-container" style={{ zIndex: curMode ==='3d' ? 2 : 1}}></div>
```

试下效果：

![2025-07-02 21.07.40.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78862180a54441dab862c8696ad215fd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=1519966&e=gif&f=50&b=a8d2e2)

切换 2D 视图的时候，3D 视图在右上角。

切换 3D 视图的时候，2D 视图在右上角。

但有个问题：

![2025-07-02 21.09.51.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/198e64f28764437c86d26424974dbf0d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=896357&e=gif&f=26&b=f4f4f4)

当视图变小之后，家具就没法编辑了。

还有一个是 resize 的时候，小视图突然变大了：


![2025-07-02 21.12.56.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c4f67176638346968cc6e3cb085342d4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=1218750&e=gif&f=21&b=f4f4f4)

这俩问题都是因为我们之前都是用的大的 width、height：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/965bf5a0640f4beb93573a0843a5f09a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1270&h=834&s=172838&e=png&b=1f1f1f)


我们在窗口 resize 的时候，拿到 canvas 大小，如果是 200，那就不变了：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e3f35cc4d8894b11ab0cc1c2da719e41~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1314&h=842&s=150022&e=png&b=1f1f1f)

```javascript
const size = renderer.getSize(new THREE.Vector2());

if(size.y === 200) {
    return;
}
```
另一个视图也是这么改：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b769cd32309f4f528c9ce8730773a132~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1170&h=844&s=147419&e=png&b=1f1f1f)

再试下：

![2025-07-02 21.18.07.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/088d5d32961f4ec9900c5ad049a08e14~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=7185253&e=gif&f=44&b=f4f4f4)

现在窗口 resize 的时候，就只有大的视图会重新设置 canvas 大小了。

再来解决小视图没法编辑家具位置的问题：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a0645a58a9a4351a5bc3a0d15b88736~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1612&h=1166&s=279371&e=png&b=1f1f1f)

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2665010ab86b459eb697dcbf26082719~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1568&h=976&s=253182&e=png&b=1f1f1f)
```javascript
const { x: width, y: height} = renderer.getSize(new THREE.Vector2());
```

同样的方式，width、height 改成动态取的 canvas 宽高就可以了。

试一下：


![2025-07-02 21.21.49.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2f94b91042634067bebca3710df267d1~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=1365488&e=gif&f=42&b=f4f4f4)


![2025-07-02 21.22.21.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/004ba0b3f020441b8f53e85ff5bfa3ff~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=1127844&e=gif&f=50&b=a8d2e2)

现在就可以操作小视图了。

>案例代码上传了[小册仓库](https://github.com/QuarkGluonPlasma/threejs-course-code/tree/main/home-decoration-editor)

## 总结

这节我们实现了大小视图。

之前切换 2D、3D 视图的时候是修改 display 来实现显示隐藏。

现在是切换 canvas 的 width、height 和 z-index。

我们在 threejs 初始化的时候暴露了一个修改 size 的方法给组件里调用，切换视图的时候调用来设置 canvas 的 size。

此外，要注意窗口 resize 的时候，处理鼠标事件的时候都要改为动态获取 width、height 才可以。
