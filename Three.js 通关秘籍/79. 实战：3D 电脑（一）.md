前面学了 CSS3DRenderer 一直没练习下：

![2025-04-08 00.09.03.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc1a58ab84cd4557be2b79d75d7f0724~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2348&h=1354&s=1602347&e=gif&f=63&b=000000)

这节我们就来做一个实战：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/34d03a502749401b9a62557650504322~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1356&h=792&s=1081371&e=png&b=252b2d)

我们来实现一个这样的电脑，并且是可以操作的，屏幕可以点击、滚动那种。

这种需求很明显要用 CSS3DRenderer 结合网页来实现。

这里网页渲染我们用 React 前端框架。

创建项目：

```
npx create-vite css3d-computer
```

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5653031618eb4b60a40ecfcfbfe396f4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=818&h=620&s=85037&e=png&b=000000)

选择 react、js 来创建 vite 项目。

进入项目，安装依赖：

```
pnpm install
pnpm install --save three
pnpm install --save-dev @types/three
```

去掉 StrictMode 和 index.css

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7447fcfea5784541a99229736524f57e~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1262&h=580&s=98926&e=png&b=1f1f1f)

然后改一下 App.jsx

```javascript
import { useEffect, useRef, useState } from 'react';
import { init } from './3d-init'
import './App.css'

function App() {

  useEffect(() => {
    const dom = document.getElementById('content');
    const { scene } = init(dom);
  
    return () => {
      dom.innerHTML = '';
    }
  }, []);

  return <div>
    <div id="main">
      <div id="content">
      </div>
    </div>
  </div>
}

export default App
```
在 App.css 写下样式：

```css
body {
  margin: 0;
}
```
然后来初始化 3d 场景：

创建 3d-init.js

```javascript
import * as THREE from 'three';
import {
    OrbitControls
} from 'three/addons/controls/OrbitControls.js';
import mesh from './mesh';

export function init(dom) {

    const scene = new THREE.Scene();
    scene.add(mesh);

    const axesHelper = new THREE.AxesHelper(500);
    scene.add(axesHelper);

    const directionalLight = new THREE.DirectionalLight(0xffffff);
    directionalLight.position.set(500, 400, 300);
    scene.add(directionalLight);

    const ambientLight = new THREE.AmbientLight(0xffffff);
    scene.add(ambientLight);

    const width = window.innerWidth;
    const height = window.innerHeight;

    const camera = new THREE.PerspectiveCamera(60, width / height, 1, 10000);
    camera.position.set(0, 500, 500);
    camera.lookAt(0, 0, 0);

    const renderer = new THREE.WebGLRenderer({
        antialias: true
    });
    renderer.setSize(width, height);

    const controls = new OrbitControls(camera, renderer.domElement);

    function render(time) {
        controls.update(time);
        renderer.render(scene, camera);
        requestAnimationFrame(render);
    }

    render();

    dom.append(renderer.domElement);

    window.onresize = function () {
        const width = window.innerWidth;
        const height = window.innerHeight;

        renderer.setSize(width,height);

        camera.aspect = width / height;
        camera.updateProjectionMatrix();
    };

    return {
        scene,
        renderer,
        controls
    }
}
```
创建 mesh.js

```javascript
import * as THREE from 'three';

const group = new THREE.Group();

const geometry = new THREE.BoxGeometry(100, 100, 100);
const material = new THREE.MeshLambertMaterial({
    color: 'orange'
});
const mesh = new THREE.Mesh(geometry, material);

group.add(mesh);

export default group;

```
我们先跑起来看下：

```
npm run dev
```
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7fde7f0a6ae044729e47353f738b13ca~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1038&h=398&s=45048&e=png&b=181818)


![2025-07-03 10.26.37.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d95ca0b0ad654b269d268f8467ba688c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=119595&e=gif&f=10&b=000000)

然后从 sketchfab 找个电脑模型：

https://sketchfab.com/3d-models/desktop-monitor-low-poly-a30bb55b7e774b1fa696edbee9588835#download


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12420e813cf34cd7ae3e3b7b52dff9d0~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2126&h=1446&s=1053490&e=png&b=f3f3f3)

下载下来放到 public 目录：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd0ec3174c5040d29dae5e02b193d59c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1526&h=1250&s=389165&e=png&b=f3f3f3)


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c326bf846e148ab9f04389016cec154~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=752&h=412&s=32998&e=png&b=1a1a1a)

改下 mesh.js 加载下模型：

```javascript
import * as THREE from 'three';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

const loader = new GLTFLoader();

const mesh = new THREE.Group();

loader.load("./monitor.glb", function (gltf) {
    console.log(gltf);
    mesh.add(gltf.scene);
    gltf.scene.scale.set(300, 300, 300);
})

export default mesh;
```


![2025-07-03 10.32.12.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5712886f601e446cb6b2a47756cdb1d7~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=1535456&e=gif&f=18&b=000000)

调整下相机的位置和 lookAt:


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f09fbd0edab6498d8fa2ef21ada8e45d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1746&h=362&s=88941&e=png&b=1f1f1f)

相机位置是从 x 轴正方向看过去，焦点在电脑的中心，差不多 100 高度的位置。

注意，lookAt 改了要修改 controls 的 target，不然会重置到 0,0,0


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09ebccbfc7ed484299552908ef566505~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1588&h=630&s=119670&e=png&b=1f1f1f)

```javascript
camera.position.set(600, 500, 0);
camera.lookAt(0, 100, 0);
```
```javascript
controls.target.set(0, 100, 0);
```


![2025-07-03 10.37.11.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b0684434201d427198fcbfed27147c90~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=2023201&e=gif&f=29&b=000000)

这样就好了。

改一下背景色：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ed9b992a0d74469e84e6bc616327bcd8~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1336&h=524&s=105638&e=png&b=1f1f1f)

```javascript
renderer.setClearColor('lightyellow');
```

![2025-07-03 10.38.47.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/891d2edda1764358b89ed498e09f4173~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=843619&e=gif&f=18&b=fdfedc)

电脑后面没有反光，有点假。

我们调一下平行光位置和强度：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7a402ae09fc84ef199f29a1b11d3857d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1678&h=362&s=86803&e=png&b=1f1f1f)

```javascript
const directionalLight = new THREE.DirectionalLight(0xffffff, 10);
directionalLight.position.set(-100, 1000, 0);
directionalLight.lookAt(0, 0, 0);
```
灯光在电脑上方偏后的位置，强度调为 10


![2025-07-03 10.44.42.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45409e5d6bd94b6e9eb50285c89425f9~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=1036706&e=gif&f=27&b=fdfedc)

这样就好多了。

然后我们加个办公桌：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b8ffa66e306f46c581cf847aaf6ee67c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2178&h=1388&s=903566&e=png&b=816d66)

下载下来放 public 目录下：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f8239bfb20f4a9ba6adb866d1256391~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=702&h=446&s=34629&e=png&b=191919)

加载进来：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a908726fc2a461da4e9548f75a0c3dd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1182&h=598&s=93533&e=png&b=1f1f1f)

```javascript
loader.load("./desk.glb", function (gltf) {
    console.log(gltf);
    mesh.add(gltf.scene);
    gltf.scene.scale.set(200, 200, 200);
})
```

![2025-07-03 10.50.54.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2cef478fb0c34f82b33579ec59e6b8a3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=5437710&e=gif&f=23&b=fefddb)

调一下旋转角度：

```javascript
gltf.scene.rotateY(Math.PI / 2);
```


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e78f2be3a0e41c8add9c646ab06fd43~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2774&h=1434&s=1328458&e=png&b=fffede)

有点近了，调远点：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa5ea90a9f8e490c880c428b27911585~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1114&h=372&s=70826&e=png&b=1f1f1f)


![2025-07-03 10.54.39.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/739aaafc10b2438ca7f37b9e48ef89d5~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=2000714&e=gif&f=17&b=fffedc)

背景色还是改为浅蓝色：

```javascript
renderer.setClearColor('lightblue');
```
去掉坐标轴：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dfe66f04502f46a19af8695b8fe71d1f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1144&h=330&s=57159&e=png&b=1f1f1f)


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ca4fda6e7e6f4d3187175b4240f4acff~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2124&h=1334&s=509169&e=png&b=add9e6)

然后我们加一下阴影：

给电脑开启投射阴影：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/56f6689400de4286a5811e53ac29fa63~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1196&h=644&s=113911&e=png&b=1f1f1f)

```javascript
gltf.scene.traverse(obj => {
    obj.castShadow = true;
});
```

renderer 开启阴影渲染：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9be3c93de6c84a3aaa3dfe15da56f45a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1214&h=502&s=88203&e=png&b=1f1f1f)

```javascript
renderer.shadowMap.enabled = true;

```
然后给灯光开启投射阴影，设置下阴影矩阵：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8cc16968eca54a17a90d60dc048313b2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1748&h=854&s=222878&e=png&b=1f1f1f)

```javascript
directionalLight.castShadow = true;
directionalLight.shadow.camera.left = -200;
directionalLight.shadow.camera.right = 200;
directionalLight.shadow.camera.top = 100;
directionalLight.shadow.camera.bottom = -100;
directionalLight.shadow.camera.near = 0.5;
directionalLight.shadow.camera.far = 1000;

const cameraHelper = new THREE.CameraHelper(directionalLight.shadow.camera);
scene.add(cameraHelper);
```

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/713aaf560942489c936505f705d7f8a8~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1528&h=1446&s=519745&e=png&b=afd9e6)

投影矩阵有点小，调大一点：

```javascript
directionalLight.castShadow = true;
directionalLight.shadow.camera.left = -800;
directionalLight.shadow.camera.right = 800;
directionalLight.shadow.camera.top = 500;
directionalLight.shadow.camera.bottom = -500;
directionalLight.shadow.camera.near = 0.5;
directionalLight.shadow.camera.far = 2000;
```

![2025-07-03 11.14.40.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/38554433fc1b4fbe99f5ee29c943c077~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=2460889&e=gif&f=21&b=a3d1e1)

现在投影矩阵大小就正好了。

那为啥没有产生阴影呢？

因为没有物体接收阴影啊。

给桌子开启接收阴影。


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f22854e9004644aa856b40c5756de351~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1280&h=846&s=124328&e=png&b=1f1f1f)

```javascript
gltf.scene.traverse(obj => {
    obj.receiveShadow = true;
});
```

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ffcd1c7f382740c5941fbe7ad02bd6f1~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1596&h=1132&s=581658&e=png&b=add9e6)

这样就有阴影了。

去掉 cameraHelper 看一下：

![2025-07-03 11.19.08.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17aae115022744c8b40cb0effb4a1d1b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2812&h=1398&s=2294572&e=gif&f=21&b=a4d1e2)

场景搭建完成。

>案例代码上传了[小册仓库](https://github.com/QuarkGluonPlasma/threejs-course-code/tree/main/css3d-computer)
## 总结

这节我们搭建了电脑、桌面的场景。

从 sketchfab.com 找的电脑和桌子的模型，调节了相机的角度和 lookAt 还有灯光位置，加上了阴影。

下节我们来用 CSS3DRenderer 加上电脑屏幕的内容。
