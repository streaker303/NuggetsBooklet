上节把窗户绘制出来了：

![2025-06-18 17.50.47.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9103f2dec8234865bff82e436c7ab288~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=947835&e=gif&f=39&b=faf6e0)

这节继续来做门的绘制。

和窗户流程是一样的，我们来快速实现一遍：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2bcadde415be4a2fbdcd44f005cd5c97~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1258&h=1030&s=126552&e=png&b=1f1f1f)

首先在最后一面墙加一个 doors 的数组，结构和 windows 一样。

```javascript
doors: [
    {
        leftBottomPosition: {
            x: 200,
            z: 20
        },
        width: 300,
        height: 400
    }
]
```
然后在 ts 类型里也加一下：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc233c4f27554f05aecc42dfc1b5411b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=996&h=1168&s=118906&e=png&b=1f1f1f)

```javascript
doors?: [
    {
        leftBottomPosition: {
            x: number,
            z: number
        },
        width: number,
        height: number
    }
]
```
绘制的时候也和 windows 差不多。

我们先把 holes 绘制出来：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51e4990040d7490082b06d28b78fa78a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1324&h=1080&s=205142&e=png&b=1f1f1f)

```javascript
item.doors?.forEach(async door => {
    const path = new THREE.Path();

    const { x, z } = door.leftBottomPosition;

    path.moveTo(x, z);
    path.lineTo(x + door.width, z);
    path.lineTo(x + door.width, z + door.height);
    path.lineTo(x, z + door.height);
    path.lineTo(x, z);
    shape.holes.push(path);
})
```


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3bfa71f65bc843fa84b9b3ccd1bbae11~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1382&h=940&s=77773&e=png&b=f6f1df)

然后找个门的模型。

从 sketchfab.com 来找：

https://sketchfab.com/3d-models/door-adf292f437f24151918a3b16ecef52d2#download


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4ea6ae6331264a1081812a5c963c989b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2014&h=1256&s=1665161&e=png&b=dfdad8)


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1fc8ad754814fb0841953513aac1d1a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=560&h=324&s=25095&e=png&b=181818)

下载下来放到 public 目录。

写个 loadDoor 方法，和 loadWindow 一样：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3557cdb19e7a40449a238a9f23c84776~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1446&h=1210&s=211762&e=png&b=1f1f1f)

```javascript
let doorModel: { model: THREE.Group, size: THREE.Vector3} | null = null;

async function loadDoor() {
    if(doorModel !== null) {
        return doorModel;
    } else {
        const group = new THREE.Group();
        const loader = new GLTFLoader();
        const gltf = await loader.loadAsync("./door.glb");
        group.add(gltf.scene);
        
        const box = new THREE.Box3();
        box.expandByObject(gltf.scene);

        const size = box.getSize(new THREE.Vector3());
        // console.log('size', size)
        doorModel =  {
            model: group,
            size
        };
        return doorModel;
    }
}
```
渲染出来看一下：

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/020c121d2fbe43dfbc77431621d5a5eb~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1188&h=960&s=153470&e=png&b=1f1f1f)

```javascript
const { model, size} = await loadDoor();
wall.add(model);
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5c21d03089547b690ffd4e70220522e~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1162&h=700&s=85178&e=png&b=f8f4df)

调整下大小：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a7d0e5646cfd4e2fbe6f74ef7cf5b788~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1198&h=940&s=169860&e=png&b=1f1f1f)

门的方向和之前不一样，这次调整 y、z 的 scale，然后绕 y 轴旋转 90 度

```javascript
model.scale.y = door.height / size.y;
model.scale.z = door.width / size.z;
model.rotateY(Math.PI / 2);
```

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92fa5c2da1a640e6938cb821c9552a72~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1376&h=944&s=83538&e=png&b=f7f3df)

现在的大小和角度就都对了。

然后移动下位置：

怎么计算门的位置呢？


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7ca3c3d764f4bd4a955c9fa5bc5443b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1260&h=860&s=87674&e=png&b=f5f0de)

leftBottomPosition 加上 width 的一半、height 的一半就可以得到。

试一下：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1881414e29a449709599a56f1d9e0405~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1478&h=648&s=138255&e=png&b=1f1f1f)

```javascript
model.position.x = door.leftBottomPosition.x + door.width / 2;
model.position.y = door.leftBottomPosition.z + door.height / 2;
```
![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a238cdd6f2564d78aa3d4ebfcff3dd0b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1196&h=798&s=129444&e=png&b=f3edde)

可以看到，计算出来的位置是对的。

此外，之前窗户的位置计算有点问题：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec0c169959b24066ad194c86d3529209~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1158&h=914&s=150310&e=png&b=1f1f1f)

之前是窗户正好在中间，所以 x、y 设置墙宽高的一半就行。

实际上也应该是上面的计算方式，改一下：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/63e82eb662944cda9e74fb1437f54e51~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1442&h=686&s=127376&e=png&b=1f1f1f)

```javascript
model.position.x = win.leftBottomPosition.x + win.width / 2;
model.position.y = win.leftBottomPosition.z + win.height / 2;
```
然后改下数据，让窗户不在正中间：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5408dd5d2fa4118a46485908cfc8900~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1150&h=978&s=103364&e=png&b=1f1f1f)

```javascript
{
    leftBottomPosition: {
        x: 100,
        z: 50
    },
    width: 300,
    height: 300
}
```


![2025-06-18 18.45.55.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a2bd6c8b7b64cc9a19e086c7f14fd5e~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=730323&e=gif&f=33&b=fdf9e0)

窗户的位置依然计算正确。

现在还有一个问题，leftBottomPosition 的 x、z 不好理解，其实它的含义是洞的位置与墙的 left、bottom 的距离。

所以我们统一优化下，改成 left、bottom：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9017d9c21b294e8b9a1cc5829dcbccbb~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1030&h=1160&s=134071&e=png&b=1f1f1f)


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4a664adb5c74eeb96dac2dcc529f62c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1200&h=1168&s=158018&e=png&b=202020)


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5ad73b2093b47258e02fc4c8e609468~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1198&h=1038&s=100355&e=png&b=202020)

在 Main/index.tsx 里统一替换 leftBottomPosition.x 为 leftBottomPosition.left

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/87cf7f67a3a046119ee6dfa92a60a6eb~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1608&h=818&s=190325&e=png&b=202020)

统一替换 leftBottomPosition.x 为 leftBottomPosition.bottom

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/82d43b93f7b24ccc8b03f7b1fe742de4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1054&h=722&s=122217&e=png&b=212121)

然后还要改这两个位置：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/760a05c9ff5a4387bbdf06e4ddd0a342~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1332&h=842&s=163137&e=png&b=1f1f1f)


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b03f155038749618dcf853f339eacc1~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1346&h=820&s=152167&e=png&b=1f1f1f)
```javascript
const { left, bottom } = win.leftBottomPosition;

path.moveTo(left, bottom);
path.lineTo(left + win.width, bottom);
path.lineTo(left + win.width, bottom + win.height);
path.lineTo(left, bottom + win.height);
path.lineTo(left, bottom);
shape.holes.push(path);
```
```javascript
const { left, bottom } = door.leftBottomPosition;

path.moveTo(left, bottom);
path.lineTo(left + door.width, bottom);
path.lineTo(left + door.width, bottom + door.height);
path.lineTo(left, bottom + door.height);
path.lineTo(left, bottom);
shape.holes.push(path);
```
运行效果不变：


![2025-06-18 18.54.45.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/af1d2fc9951e4b7a8a7ebe390c9f5f3f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=300169&e=gif&f=14&b=fbf6df)

但代码可读性提升了，这次重构就算是有意义的。

最后，之前的数组的 ts 类型写的有点问题：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b0750561a4474d099ae820bd317567d9~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=722&h=980&s=79288&e=png&b=1f1f1f)

这样写表示数组只有一个元素。

应该这么写：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ecf4b89fe5684cb3aeaa361c82276efa~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=754&h=900&s=93066&e=png&b=1f1f1f)

```javascript
windows: Array<{
    leftBottomPosition: {
        left: number,
        bottom: number
    },
    width: number,
    height: number
}>,
doors?: Array<{
    leftBottomPosition: {
        left: number,
        bottom: number
    },
    width: number,
    height: number
}>
```
并且 windows 加上可选标记 ?

用的时候也做下空值的处理：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a316dbcb968c4d84a41e19219a4c58ff~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1130&h=628&s=118329&e=png&b=1f1f1f)

>案例代码上传了[小册仓库](https://github.com/QuarkGluonPlasma/threejs-course-code/tree/main/home-decoration-editor)

## 总结

这节我们加上了门的数据结构以及绘制逻辑，并且重构了下代码。

门的数据结构和窗户的一样，都是记录洞的位置，然后绘制的时候把它用 Shape 画出来，加到 holes 数组里，之后加载一个门的模型放在那个位置。

只不过因为旋转角度不同，scale 需要设置不同方向的值。

门窗绘制好了，下节来绘制地板、天花板。
