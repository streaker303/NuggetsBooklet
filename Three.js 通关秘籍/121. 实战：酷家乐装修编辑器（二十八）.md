在酷家乐里，当你编辑完之后可以点击渲染进入全景浏览：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4c4d241663384d3b958c1f024f3102a2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2826&h=1436&s=2266700&e=png&b=f2f4f5)

就会进入看效果的视角：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28fb94f3d578477ea2724906305a7988~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2832&h=1436&s=2195494&e=png&b=d0cbca)

不再是编辑视角。

我们也来实现下这个全景浏览功能。

首先加一个渲染按钮：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/529ef89d3978462fa969adc45a2ce184~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1304&h=646&s=120706&e=png&b=1f1f1f)

```javascript
<div className="btns">
    <Button type="primary"><CameraOutlined />渲染</Button>
</div>
```
加下样式：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/048a99831dd144dcae89731c5ec35768~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=940&h=770&s=94612&e=png&b=1f1f1f)

```scss
display:flex;
justify-content: space-between;
.btns {
  margin-right: 20px;
  margin-top: 15px;
}
```


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/effdb2341ce54ac0b373ba6698d3e847~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2778&h=1456&s=885623&e=png&b=b2d8e6)

点击按钮的时候，要弹出一个单独的界面来预览：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28fb94f3d578477ea2724906305a7988~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2832&h=1436&s=2195494&e=png&b=d0cbca)

我们写个新组件：

创建 src/components/Preview/index.tsx

```javascript
import { CloseCircleOutlined } from "@ant-design/icons";

function Preview() {
    return <div id="preview">
        <div className='close-btn'>
            <CloseCircleOutlined />
        </div>
    </div>
}

export default Preview;
```
加一下样式：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f97e74d4268c4fefad08727cf7e29487~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=794&h=922&s=102993&e=png&b=1f1f1f)

```css
#preview {
  position: absolute;
  background: pink;
  width: 100%;
  height: 100%;
  z-index: 10;

  .close-btn {
    position: absolute;
    right: 20px;
    top: 20px;
    font-size: 30px;
    cursor:pointer;
  }
}
```

引入下：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac4703596e4b412197205a2ba835a741~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1220&h=1178&s=163436&e=png&b=1f1f1f)

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1bc45281346748248b6a70d5b23dcf52~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2858&h=1502&s=82501&e=png&b=ffc0ca)

然后我们要在这里渲染一遍 3D 场景。

首先初始化一下：

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eeac72e519ae443cbb737d9928d15619~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1350&h=1084&s=178981&e=png&b=1f1f1f)

```javascript
useEffect(() => {
    const dom = document.getElementById('preview-container')!;
    const { } = initPreviewScene(dom);

    return () => {
      dom.innerHTML = '';
    }
}, []);
```
```javascript
<div id="preview-container"></div>
```
加一个 dom，在这下面挂载 canvas

创建 Preview/init-preview.ts

```javascript
import * as THREE from 'three';
import {
    OrbitControls
} from 'three/addons/controls/OrbitControls.js';

export function initPreviewScene(
    dom: HTMLElement
) {
    const scene = new THREE.Scene();

    const axesHelper = new THREE.AxesHelper(5000);
    scene.add(axesHelper);

    const directionalLight = new THREE.DirectionalLight(0xffffff);
    directionalLight.position.set(0, 1500, 0);
    scene.add(directionalLight);

    const ambientLight = new THREE.AmbientLight(0xffffff, 2.5);
    scene.add(ambientLight);

    const width = window.innerWidth;
    const height = window.innerHeight;

    const camera = new THREE.PerspectiveCamera(60, width / height, 1, 100000);
    camera.position.set(6000, 4000, 6000);
    camera.lookAt(0, 0, 0);

    const renderer = new THREE.WebGLRenderer({
        antialias: true
    });
    renderer.setSize(width, height);

    const controls = new OrbitControls(camera, renderer.domElement);

    function render() {
        renderer.render(scene, camera);
        requestAnimationFrame(render);
    }

    render();

    dom.append(renderer.domElement);

    window.onresize = function () {
        const width = window.innerWidth;
        const height = window.innerHeight;

        renderer.setSize(width,height);

        camera.aspect = width / height;
        camera.updateProjectionMatrix();
    };

    return {
        scene,
        camera,
        controls
    }
}
```
跑一下：

![2025-07-28 21.23.09.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/adaa62988c444e74b8d5428c1711e199~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2736&h=1534&s=194022&e=gif&f=24&b=000000)

先不着急渲染这个场景，我们先把点击渲染按钮展示这个场景，以及点击关闭按钮关闭的逻辑写一下：

改下关闭按钮的颜色：

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/503079698b294f7ca7d55bdd1c97905a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=706&h=732&s=87423&e=png&b=1f1f1f)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d47c0aa9f8f4f899356529463e1d36f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1592&h=844&s=30340&e=png&b=000000)

点预览按钮显示这个预览的场景：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9345dcc03966459fbda60adb32a227a5~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1808&h=1138&s=471135&e=png&b=afd9e6)

点击关闭按钮隐藏。

明显需要跨组件通信，我们把它放到 store 里。


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/130b3565b74a4a068c8809171901a048~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1710&h=1338&s=244430&e=png&b=1f1f1f)

```javascript
showPreview: boolean
```
```javascript
toggleShowPreview(): void;
```
```javascript
showPreview: false,
toggleShowPreview() {
    set(state => {
        return {
            ...state,
            showPreview: !state.showPreview
        }
    })
},
```
加一个 showPreview 的布尔值和修改它的方法。

然后我们用这个来控制预览界面的显示隐藏：

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/313580b45b4342a0a9903c4f7b5809da~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1572&h=1170&s=237776&e=png&b=1f1f1f)

```javascript
const { showPreview, toggleShowPreview } = useHouseStore();
```
```javascript
style={{display: showPreview ? 'block' :  'none'}}
```
```javascript
onClick={toggleShowPreview}
```
点击关闭的时候切换显示隐藏。

点击渲染按钮的时候也是：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6188810cdc624a63b422394861255976~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1626&h=890&s=167791&e=png&b=1f1f1f)

```javascript
const { toggleShowPreview } = useHouseStore();
```
```javascript
onClick={() => toggleShowPreview()}
```

试下效果：


![2025-07-28 22.21.46.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/24606f6379bf47a4bd43ddcfa5bd6fc3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=2111280&e=gif&f=36&b=acd4e3)

这样，预览场景的初始化就完成了。

>案例代码上传了[小册仓库](https://github.com/QuarkGluonPlasma/threejs-course-code/tree/main/home-decoration-editor)

## 总结

这节我们加了一下预览场景，它是用来看编辑后的效果的。

我们单独加了一个 Preview 组件和对应的场景初始化代码，点击渲染按钮的时候展示这个场景，点击关闭按钮隐藏。

下节我们来实现预览场景里的内容。
