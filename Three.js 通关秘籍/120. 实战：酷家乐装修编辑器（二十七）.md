上节用 draco 压缩了模型，并且加了 loading：

![2025-07-27 18.53.06.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9cefba287c7e4883b6569e746c32cf9b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2736&h=1534&s=1661569&e=gif&f=48&b=f9f9f9)

提升了加载性能、操作体验。

这节我们美化一下 loading，改成进度条的形式。

我们用 antd 的 Progress 组件写进度条：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/992405b4e6e743f9b4b79c2daa3d7629~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1616&h=952&s=128923&e=png&b=fdfdfd)

先把这个 setModelLoaded 注释掉，我们来调样式：

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/62a3182bb28248fead9a4b6e68e1bd1f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1506&h=1394&s=205865&e=png&b=1f1f1f)

```javascript
<div id="loading">
  <p>loading...</p>
  <Progress
    percent={50}
    style={{width:500}}
    percentPosition={{ align: 'start', type: 'inner' }}
    size={[500, 30]}
    strokeColor="#B7EB8F"
  />
</div>
```
用 Progress 组件来做进度条。

改下样式：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a85c265c904c4416b50591b1853f5302~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=878&h=742&s=84424&e=png&b=1f1f1f)

```css
#loading {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
```

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/15f0e947a9804a5a8d0d479d14ec346c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2564&h=1370&s=71323&e=png&b=ffffff)

样式调好了，接下来调数值。

gltfLoader.loadAsync 的第二个参数的回调函数就可以拿到进度：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b2c901eb8874518aca9501bde1bb8b6~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1306&h=698&s=169555&e=png&b=202020)

```javascript
'./bed.glb': gltfLoader.loadAsync('./bed.glb', (event) => {
  const percent = event.loaded / event.total;
  console.log('进度：', percent * 100 + ' %')
} ),
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/08f19b622d564e71af8877eaebf37885~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1982&h=1254&s=205740&e=png&b=fefefe)

每个模型的加载都可以计算这样的进度

我们每个模型的进度算 25%，这样 4 个模型加起来正好 100% 进度。

当然，你也可以大模型进度分配的多一点，小模型少一点，这里就不分那么细了。



![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/189c8651e32b4ac6a4ce91ad991badd2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1948&h=1280&s=264930&e=png&b=1f1f1f)

```javascript
useEffect(() => {
    const percentArr = [0, 0, 0, 0];
    ['./bed.glb', './dining-table.glb', './door.glb', './window.glb'].forEach((modelUrl, index) => {
      modelMap[modelUrl] = gltfLoader.loadAsync(modelUrl, (event) => {
        const per = event.loaded / event.total;
        percentArr[index] = per;

        let total = 0;
        percentArr.forEach(item => {
          total += item;
        });
        setPercent(Math.floor(total / 4 * 100));
      });
    })
}, []);
```
把加载模型的逻辑放到组件里，用一个数组保存每个模型的进度。

进度更新的时候计算下总进度，除以 4 乘以 100 然后取整，就是 0-100 的整数。

试一下：


![2025-07-27 22.11.37.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c899b3a27bf14865a4380b3f4bb4483b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2736&h=1534&s=360200&e=gif&f=23&b=fefefe)

当然，本地的网速会比较快，我们用 devtools 把网速调成 4g 的：


![2025-07-27 22.12.23.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/200e9ebfa05f4d57b33a4bab1d394946~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2736&h=1534&s=764718&e=gif&f=44&b=fdfdfd)

这样就明显多了。

去掉 setModelLoaded(true) 的注释，看下整体效果：

![2025-07-27 22.13.40.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5fd63cfbe0c64e7e9d2ec3d8c8e24529~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2736&h=1534&s=1281278&e=gif&f=31&b=aad3e2)

然后我们把 Header 部分改一下：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2481e00f565042fe902704f81e6e9ab4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1082&h=398&s=60144&e=png&b=1f1f1f)

```javascript
function Header() {
    return <div className="Header">
        <h1 className="logo">仿酷家乐装修编辑器</h1>
    </div>
}

export default Header;
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb85883e9fa94b27835f71801f7a6ff0~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=960&h=896&s=113661&e=png&b=1f1f1f)

```css
.logo {
  line-height: 60px;
  margin: 0;
  margin-left: 20px;
  font-size: 36px;
  color: #999;
  font-weight: normal;
  text-shadow: 2px 2px 4px lightblue;
}
```


![2025-07-27 22.32.18.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ba64227d0414e07837696c8c8b196e4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2736&h=1534&s=1317094&e=gif&f=28&b=aad3e2)

>案例代码上传了[小册仓库](https://github.com/QuarkGluonPlasma/threejs-course-code/tree/main/home-decoration-editor)

## 总结

这节我们美化了下进度条。

gltfLoader.loadAsync 可以在第二个参数的回调函数拿到进度，我们可以把 4 个模型的进度都记录在数组里，然后求和除以 4，就是整体的进度。

当然，你可以给每个模型分配不同的权重，比如大模型的进度占比多一些。

下节我们来实现编辑完之后的全景看房功能。
