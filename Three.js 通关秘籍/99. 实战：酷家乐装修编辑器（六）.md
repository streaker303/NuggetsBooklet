上节把洞挖好了：

![2025-06-16 16.14.16.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91def533833a4c5e90e285313084d0ae~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=873473&e=gif&f=33&b=fcfbdc)

我们加载一个窗户的模型放在这个位置，调整下大小。

从 sketchfab.com 来找：

https://sketchfab.com/3d-models/window-af3ba48119bc482a8d0077f0f265cd4a#download


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/164b548e15c44f8f8523cab6ee4133a1~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2310&h=1442&s=2217196&e=png&b=f1f1f1)


下载下来放在 public 目录下：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4ad13fc0187f4dc1b50d82ad230ee820~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=584&h=308&s=25304&e=png&b=191919)

代码里加载进来：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/136923e6e85e44088d3fdff272e11228~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1518&h=1140&s=206222&e=png&b=1f1f1f)

```javascript
let winModel: { model: THREE.Group, size: THREE.Vector3} | null = null;

async function loadWindow() {
    if(winModel !== null) {
        return winModel;
    } else {
        const group = new THREE.Group();
        const loader = new GLTFLoader();
        const gltf = await loader.loadAsync("./window.glb");
        group.add(gltf.scene);
        
        const box = new THREE.Box3();
        box.expandByObject(gltf.scene);

        const size = box.getSize(new THREE.Vector3());
        console.log('size', size)
        winModel =  {
            model: group,
            size
        };
        return winModel;
    }
}
```
我们用一个全局变量来存储窗户模型，这样全局只加载一次。

使用 loadAsync 和 async await 来实现同步加载之后返回。

因为我们要加载完模型后计算大小再返回。

用 Box3 包围盒来拿到模型大小。

先加载看下效果：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/667e4bd457d446d38f535a34842f0471~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1152&h=984&s=168614&e=png&b=1f1f1f)

注意要给函数加上 async

```javascript
const { model, size} = await loadWindow();
model.scale.setScalar(200);
scene.add(model);
```
先放大 200 倍

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5abb85a6296a46a3ae71fd2b891e37b2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2250&h=1098&s=279323&e=png&b=fef6ef)

可以看到，窗户加载出来了，size 也计算了出来。

那如何设置窗户的大小、位置呢？

自然是根据窗户数据的宽高来计算：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3fd402d9142a464bb8f7c19db07b59dd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1106&h=384&s=65315&e=png&b=1f1f1f)


```javascript
model.position.x = (item.right.x - item.left.x) / 2;
model.position.y = item.height / 2;
model.scale.set(win.width / size.x, win.height / size.y, 1);
```
位置就是墙的宽度 /2 高度 /2 的位置。

宽高根据窗口宽高来放大。

看下效果：


![2025-06-18 08.03.00.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eeff2f3afcc54fcb91d38aa8de5378c1~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=2709362&e=gif&f=46&b=fffae1)

这样窗户就绘制出来了。

然后我们多加一面墙试试：

不过在那之前继续优化下存储结构：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09b9ebfe30ce43928344cd0d43eb2d83~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1042&h=902&s=83331&e=png&b=1f1f1f)

之前记录了墙的左右端点的，好像也没啥必要，直接记录 width 和 position 就行。

有了 width 和 position 自然可以计算出左右端点坐标。


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41b01386689d47ed8d75758361bcbfdf~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1122&h=556&s=74588&e=png&b=1f1f1f)


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95b558a068ed44429a8237401ff7d560~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=878&h=288&s=35530&e=png&b=1f1f1f)
```javascript
position: { x: 0, y: 0, z: 0},
width: 800,
```

```javascript
position: { x: number, y: number, z: number},
width: number,
```
绘制的代码自然也要改一下：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d5957dbe341a4b8293ad6edbd7c0bf26~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1164&h=548&s=94297&e=png&b=1f1f1f)

```javascript
shape.moveTo(0,0);
shape.lineTo(0, item.height);
shape.lineTo(item.width, item.height);
shape.lineTo(item.width, 0);
shape.lineTo(0, 0);
```

还是按照左下 -> 右下 -> 右上 -> 左上 -> 左下 转一圈的顺序。

直接根据 width、height 来画就行。

计算窗户位置也换成 item.width

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8db2cebe5c794ade8446243ba07193a3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1196&h=586&s=99839&e=png&b=1f1f1f)

```javascript
model.position.x = item.width / 2;
```
还要设置下墙的位置：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/20c18166d8c24ef191767275f25b67ba~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1454&h=514&s=105056&e=png&b=1f1f1f)

```javascript
wall.position.set(item.position.x, item.position.y, item.position.z);
```
多加几面墙试一下：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ba58b1f68ab45928d3d66481b2b2590~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1178&h=1094&s=102442&e=png&b=1f1f1f)

```javascript
{
    position: { x: 0, y: 0, z: 800},
    width: 800,
    height: 500,
    depth: 30,
    windows: [
        {
            leftBottomPosition: {
                x: 100,
                z: 100
            },
            width: 600,
            height: 300
        }
    ]
}
```
复制了一份墙体数据，改了下 z

看一下：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0648744ea3534472ac58553ce1f3166a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1820&h=1380&s=327849&e=png&b=fcf8e3)

墙的位置是对了，但是窗户没出来。

设置下 z 轴位置：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b1150025703047079c29848d99359663~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1146&h=680&s=113023&e=png&b=1f1f1f)

```javascript
model.position.z = item.position.z;
```

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc7498ab5ff54b21a3b7205c476ab04e~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1732&h=1266&s=406398&e=png&b=fdf8e4)

现在相机的位置有点低了，调整下相机位置：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b762c52589f44b71b6a69124f286c683~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1222&h=308&s=66915&e=png&b=1e1e1e)

```javascript
camera.position.set(1500, 1500, 1000);
```

![2025-06-18 08.41.44.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac9ffb28da0944b09f2f929d36828456~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=1084324&e=gif&f=37&b=fefbde)

此外墙的颜色不大对，这个是灯光的原因。

调节下灯光的位置，让它在房屋正上方，然后加大环境光的强度。


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f02d5215fb949f2bbf5c306a76300e4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1350&h=598&s=133572&e=png&b=1f1f1f)

```javascript
directionalLight.position.set(0, 1500, 0);
```
```javascript
const ambientLight = new THREE.AmbientLight(0xffffff, 2);
```


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d29e88e2a99d4809bc20fea9635f53c5~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1792&h=1040&s=135621&e=png&b=fcfadf)

这样就好多了。

最后我们再画另外两面墙。

但现在墙的旋转角度是固定的，这个也应该不一样，把它加到 json 里：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9fd9b9943fc644a398c853c984dfdced~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=958&h=346&s=47364&e=png&b=1f1f1f)

```javascript
rotationY?: number,
```
绘制的时候设置下：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ca26dfd1be442f088be867ad8902ba4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1148&h=630&s=99990&e=png&b=1f1f1f)

```javascript
if(item.rotationY) {
    wall.rotation.y = item.rotationY;
}
```
让第一面墙旋转 60 度：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5a653b0f82a04a42b5318a62aa2c1008~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1050&h=578&s=62679&e=png&b=1f1f1f)

看下效果：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b278aed604846428c304b77401eedd5~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1694&h=890&s=131246&e=png&b=fbf9df)

可以看到，墙旋转了，但是窗户没有跟着一起旋转。

这是以为我们没把窗户添加到 wall 的 group 里。


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1cddc48b42a4d0b8b1ae37b045589ef~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1128&h=644&s=108643&e=png&b=1f1f1f)

这样墙和窗户是独立的，自然不会一起旋转。

我们把窗户添加到墙的 group 里：

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a8aa50594416444e96b37ceeda250d7f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1072&h=498&s=69431&e=png&b=1f1f1f)

这样也就不用单独设置 z 了。


![2025-06-18 08.59.31.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/30ab753c256d47349d979727d9a1b119~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=84171&e=gif&f=4&b=fcf9df)

完成。

我们改下数据，绘制完 4 面墙。

```javascript
const useHouseStore = create<State>((set, get) => {
    return {
        data: {
            walls: [
                {
                    position: { x: 0, y: 0, z: 0},
                    width: 800,
                    height: 500,
                    depth: 30,
                    windows: [
                        {
                            leftBottomPosition: {
                                x: 100,
                                z: 100
                            },
                            width: 600,
                            height: 300
                        }
                    ]
                },
                {
                    position: { x: 0, y: 0, z: 800},
                    width: 800,
                    height: 500,
                    depth: 30,
                    windows: [
                        {
                            leftBottomPosition: {
                                x: 100,
                                z: 100
                            },
                            width: 600,
                            height: 300
                        }
                    ]
                },
                {
                    position: { x: 0, y: 0, z: 0},
                    width: 800,
                    height: 500,
                    depth: 30,
                    rotationY: -Math.PI / 2,
                    windows: [
                    ]
                },
                {
                    position: { x: 800, y: 0, z: 0},
                    width: 800,
                    height: 500,
                    depth: 30,
                    rotationY: -Math.PI / 2,
                    windows: [
                    ]
                }
            ]
        }
    }
});
```

![2025-06-18 17.50.47.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9103f2dec8234865bff82e436c7ab288~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=947835&e=gif&f=39&b=faf6e0)

>案例代码上传了[小册仓库](https://github.com/QuarkGluonPlasma/threejs-course-code/tree/main/home-decoration-editor)

## 总结

这节我们加载了窗户模型，并给它设置了正确的大小、位置。

首先，我们继续优化了墙的存储结构，保存 position、rotation、width、height、depth 信息，根据这些来绘制墙。

然后加载窗户模型后，根据包围盒计算出模型的尺寸，再根据窗户的尺寸来设置 scale 就好了。

注意要把窗户添加到墙的 group 下，这样才会作为一个整体一起旋转、位移。

此外，我们加强了环境光，现在看起来就是白墙了。

下节我们继续来绘制门。
