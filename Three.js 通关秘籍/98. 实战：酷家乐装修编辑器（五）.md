上节在 json 里添加了墙的数据，并且把它绘制了出来：

![2025-05-24 20.16.12.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8bc23ff40ebd4ba7a907e59c370a3927~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2530&h=1460&s=360170&e=gif&f=29&b=a4d1e1)

这节我们来加上门窗。

先看下酷家乐的：

比如这样的门窗：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae35ef5b8a5b4410b7cd84e61c864cbb~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2148&h=1462&s=1511027&e=png&b=dad6d5)

在 2d 平面会有对应的标识：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3885b65189ec44ad93c4016d50399d18~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2020&h=1206&s=580182&e=png&b=eff0f1)

这个门窗是可以调整大小的：

![2025-06-16 15.11.48.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/29e1c9f2b7364b72820e989f2c79358b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=3225204&e=gif&f=60&b=e8edf0)

可以看到，在 2d 平面了调整了窗户大小，3d 视图的窗户也小了。

而且窗户可以更换：


![2025-06-16 15.14.28.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/677521d43d8848318e08b4206c717f9c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=1999984&e=gif&f=58&b=e9eff2)

可以移动位置：

![2025-06-16 15.15.14.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/740de847c1764b829e172cd130c3473c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=1919204&e=gif&f=32&b=e9f0f3)

那如何在墙上画出这样的门窗呢？

首先，我们用 ExtrudeGeometry 拉伸出墙壁的时候，要留下窗户和门的洞，这个洞的大小位置也要记录下来。

然后在洞的位置加载一个门窗的模型，调整门窗大小的话就是设置模型的 scale。

我们来写一下：

之前我们是由底部的 4 个点向上拉伸出墙体：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1735d59c4908417daada7d1e61ea7715~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1010&h=816&s=88748&e=png&b=1f1f1f)

但我们要挖洞的话，应该是从墙面向一侧水平拉伸。

所以我们改一下存储的结构：

比如这样一面墙：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a29e360d1374f889e7f4d1ff9c898d7~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1102&h=652&s=75093&e=png&b=1f1f1f)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/03c010222dd14565aa65d97249ce88fd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1836&h=1376&s=51655&e=png&b=add9e6)

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b821b4c89a2c48649d9c6296832cd6f9~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1848&h=1268&s=65787&e=png&b=fefee0)

我们只存储底部的两个端点的位置：

大概是这样的结构：

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fbe04fc8844c4f61a661786b6a16cd5f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1182&h=962&s=87520&e=png&b=1f1f1f)

墙底部的左右端点位置，墙的高度、厚度。

窗户的洞的左下角位置，窗户宽高。

有了这些就知道怎么画了。

```javascript
walls: [
    {
        left: {x: 0, z: 0},
        right: {x: 500, z: 0},
        height: 500,
        depth: 30,
        windows: [
            {
                leftBottomPosition: {
                    x: 100,
                    z: 100
                },
                width: 300,
                height: 300
            }
        ]
    }
]
```

类型也要改一下：



![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/71b92be4f9304f53837084cc47c33edd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1008&h=1138&s=111039&e=png&b=1f1f1f)

```javascript
interface Wall {
    left: {
        x: number,
        z: number
    },
    right: {
        x: number,
        z: number
    },
    height: number,
    depth: number,
    windows: [
        {
            leftBottomPosition: {
                x: number,
                z: number
            },
            width: number,
            height: number
        }
    ]
}
```
把之前绘制 2d 视图的代码注释掉：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/27362cd1a6bb4eacbb8f1f6e4db02776~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1440&h=1124&s=226034&e=png&b=1f1f1f)

我们先绘制 3d 的：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eb349aa82dee46618dfab0f6841c93b7~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1230&h=1042&s=191746&e=png&b=1f1f1f)

```javascript
const scene = scene3DRef.current!;
const walls = data.walls.map(item => {
    const shape = new THREE.Shape();
    shape.moveTo(item.left.x, item.left.z);
    shape.lineTo(item.right.x, item.right.z);
    shape.lineTo(item.right.x, item.right.z + item.height);
    shape.lineTo(item.left.x, item.left.z + item.height);
    shape.lineTo(item.left.x, item.left.z);

    const geometry = new THREE.ExtrudeGeometry(shape, {
        depth: item.depth
    });
    const material = new THREE.MeshPhongMaterial({
        color: 'white'
    })
    const wall =  new THREE.Mesh(geometry, material);
    // wall.rotateX(-Math.PI/2);
    return wall;
});

scene.add(...walls);
```
同样是从左下角位置、右下角位置、右上角位置、左上角位置，最后回到左下角位置。

按照这个顺序来画墙的形状，然后拉伸一定的厚度。

这样拉伸就不用旋转了。

看下效果：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/14a925e6e5be4394b203062cac4078a2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1846&h=1344&s=73816&e=png&b=fefde0)

这样墙就画出来了。

然后我们来挖孔：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8573534d06644265aa7c39de9ff5480d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1302&h=1022&s=176505&e=png&b=1f1f1f)

```javascript
item.windows.forEach(win => {
    const path = new THREE.Path();

    const { x, z } = win.leftBottomPosition;

    path.moveTo(x, z);
    path.lineTo(x + win.width, z);
    path.lineTo(x + win.width, z + win.height);
    path.lineTo(x, z + win.height);
    path.lineTo(x, z);
    shape.holes.push(path);
})
```
同样是按照从左下角到右下角、右上角、左上角来转一圈的顺序来画。

把它添加到墙的 holes 里。

看下效果：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f08709ca9bd4d4693d509fd60abc54c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2640&h=1518&s=140335&e=png&b=fefae3)

这样洞就挖好了。

AxesHelper 加长一下：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f94751f3ba7a4f37ad292084667f33db~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1006&h=296&s=51198&e=png&b=1f1f1f)


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/db4a2d1e025440e1ad504cf8d1a1ae6f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1998&h=1276&s=99170&e=png&b=fffee1)

改一下数据试试：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ff6ecf36d4384b0599b42484e0d4e517~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1112&h=1024&s=93336&e=png&b=1f1f1f)


![2025-06-16 16.12.57.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/669c44aecf3b4a3db8a07049ddaf4746~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=706910&e=gif&f=25&b=fffce1)


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd112eb589f24755a3fc3d66e03c1b1b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=790&h=746&s=57680&e=png&b=202020)


![2025-06-16 16.14.16.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91def533833a4c5e90e285313084d0ae~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2700&h=1464&s=873473&e=gif&f=33&b=fcfbdc)

没啥问题。

>案例代码上传了[小册仓库](https://github.com/QuarkGluonPlasma/threejs-course-code/tree/main/home-decoration-editor)


## 总结

这节我们实现了门窗的存储和绘制。

上节的墙体数据存储有些问题，我们改了一下：

存储墙的两个端点还有墙的高度、厚度信息，并且存储 holes 的信息，包括左下角坐标，洞的宽度、高度。

这样，门窗的洞就预留好了，下节我们在洞的位置放上门窗。
