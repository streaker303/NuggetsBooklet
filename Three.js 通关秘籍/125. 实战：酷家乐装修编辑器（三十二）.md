这节我们把选中家具时的信息面板做一下：

![2025-07-31 10.55.37.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cde225f652d149588db37f71eb758b80~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=9850732&e=gif&f=34&b=edf0f1)

去掉背景色：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/59436e863c734b3a8e43082e2d83eca1~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=836&h=514&s=55240&e=png&b=1f1f1f)

然后用 antd 的表单来展示一下：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83c1fd4e406b46fcbdf7e96ba573fdfa~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1520&h=1364&s=212052&e=png&b=202020)

```javascript
{
    curSelectedFurniture ? <div>
        <Form initialValues={
            curSelectedFurniture
        } style={{
            margin: 10
        }}>
            <Form.Item label="ID" name='id'>
                <Input disabled/>
            </Form.Item>
            <Form.Item label="位置 x" name={["position", 'x']}>
                <Input/>
            </Form.Item>
            <Form.Item label="位置 y" name={["position", 'y']}>
                <Input/>
            </Form.Item>
            <Form.Item label="位置 z" name={["position", 'z']}>
                <Input/>
            </Form.Item>
            <Form.Item label="角度 x" name={["rotation", 'x']}>
                <Input/>
            </Form.Item>
            <Form.Item label="角度 y" name={["rotation", 'y']}>
                <Input/>
            </Form.Item>
            <Form.Item label="角度 z" name={["rotation", 'z']}>
                <Input/>
            </Form.Item>
        </Form>
    </div> : null
}
```


![2025-07-31 12.52.19.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/10851d63f0604b1e8487b65e136d62ae~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=567894&e=gif&f=20&b=f5f5f5)

信息展示出来了，但现在在表单里按删除键会把家具删除：

![2025-07-31 12.52.42.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fff5564546564f159d5faaf5e20f826b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=524815&e=gif&f=16&b=f4f4f4)

我们阻止下事件冒泡就好了：

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/369ada823b0e4707bae8ef4a54280f16~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1406&h=838&s=154351&e=png&b=1f1f1f)

```javascript
onKeyDown={(evt) => {
    evt.stopPropagation();
}}
```

![2025-07-31 12.55.12.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a1655c658234dcdab12f10eeea1ae75~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=743940&e=gif&f=32&b=f6f6f6)

现在移动家具位置，切换选中的家具的时候，表单值都不会变化：

![2025-07-31 12.55.45.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/decac1d9732747388a1c8ab9dd004e1b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=1730602&e=gif&f=40&b=f9f9f9)

因为它只设置了初始值，我们要做下值的同步：



![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dbf4f2c5914b4220b639158fdd5f1293~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1380&h=1080&s=196534&e=png&b=1f1f1f)

```javascript
const [form] = useForm();
useEffect(() => {
    form.setFieldsValue(curSelectedFurniture);
}, [curSelectedFurniture]);
```
```javascript
form={form}
```
用 useForm 拿到表单实例，切换选中的家具的时候，设置下表单值。


![2025-07-31 12.59.18.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a650090a4a74008a495b7fdc16d17f2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=767090&e=gif&f=23&b=abd4e3)

然后是编辑时同步表单值：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43014af2deb449c9be7cba9ca8a23747~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1072&h=532&s=98192&e=png&b=1f1f1f)

data 变化的时候也同步设置下就好了。


![2025-07-31 13.02.39.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91236c99efb146429a8873cb36dd5509~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=1993715&e=gif&f=50&b=abd3e2)

这个旋转角度显然用滑动输入条会更好。

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a65ba912bd0f4e0fac6e26a357e62c6a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1678&h=1028&s=148269&e=png&b=fefefe)

范围是 -2π 到 2π



![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e12e43450a464a65a139601b3cf2d1c3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1456&h=1010&s=199847&e=png&b=1f1f1f)

```javascript
<Form.Item label="位置 x" name={["position", 'x']}>
    <InputNumber/>
</Form.Item>
<Form.Item label="位置 y" name={["position", 'y']}>
    <InputNumber disabled/>
</Form.Item>
<Form.Item label="位置 z" name={["position", 'z']}>
    <InputNumber/>
</Form.Item>
<Form.Item label="角度 x" name={["rotation", 'x']}>
    <Slider min={-Math.PI * 2} max={Math.PI * 2}/>
</Form.Item>
<Form.Item label="角度 y" name={["rotation", 'y']}>
    <Slider min={-Math.PI * 2} max={Math.PI * 2}/>
</Form.Item>
<Form.Item label="角度 z" name={["rotation", 'z']}>
    <Slider min={-Math.PI * 2} max={Math.PI * 2}/>
</Form.Item>
```
用 Slider 调整角度，位置应该是用 InputNumber，然后 y 方向禁用

![2025-07-31 13.15.48.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/35d377b2670e42faaffedb50649e286a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=1215972&e=gif&f=35&b=acd4e3)

然后编辑表单的时候同步到 store：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cbda2c347db64064b51eee2238dc92a5~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1326&h=1124&s=205267&e=png&b=1f1f1f)

```javascript
onValuesChange={handleValuesChange}
```
```javascript
function handleValuesChange() {
    const values  = form.getFieldsValue();
    console.log(values);
}
```
表单变化的时候打印下表单值：

![2025-07-31 13.19.35.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74d25632476f49f0a911d959de23d09d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=1648253&e=gif&f=49&b=faf9f9)

然后把它更到 store 里：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9092f0c0a788456d8b5d4c8ae36d3f5c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1350&h=670&s=146837&e=png&b=1f1f1f)

```javascript
function handleValuesChange() {
    const values  = form.getFieldsValue();
    updateFurniture(values.id, 'position', values.position);
    updateFurniture(values.id, 'rotation', values.rotation);
}
```
试一下：


![2025-07-31 13.23.17.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb279678968a47e6a93a58895f353fa8~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=1662399&e=gif&f=46&b=f4f4f4)

这样就能直接通过表单来修改家具位置角度了。

当然，这里角度也只支持绕 y 轴旋转：

![2025-07-31 13.24.18.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16b2a09fe177451ca016848b4fa03270~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=1405343&e=gif&f=29&b=f5f5f5)

把 x、z 方向的旋转禁用：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/01cd31a879cf443dbba3c2eb3acbd372~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1608&h=724&s=149469&e=png&b=1f1f1f)


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85f5d26a96384fed87a09b7ef5b7bf91~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1492&h=812&s=429638&e=png&b=f4f4f4)

整体测试下：


![2025-07-31 13.26.11.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f5293af5751e40768c0a2c925e32bcf9~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=1564990&e=gif&f=49&b=f5f5f5)

这里还有个问题：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a83d272b9e34e839b7e8f1f50e356e3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2110&h=1302&s=575024&e=png&b=afd9e6)

2D、3D 视图的家具旋转方向刚好相反。

这个也是因为我们之前 2D 视图整体旋转了 180 度的原因，家具的 rotation.y 也要旋转 180 度。

改 3 处地方：



![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c3a5d7fa4e3f4739886bd29c403a19f7~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1536&h=1124&s=205948&e=png&b=1f1f1f)
![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61a90971812640f5990a3d0a41de2de2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1354&h=706&s=131832&e=png&b=1f1f1f)

```javascript
obj.rotation.y = furniture.rotation.y + Math.PI;
```

这样就好了：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e6ed5fd7add54754b58ec2d5c35c9122~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2062&h=1296&s=544105&e=png&b=aed8e5)

顺便改下 title


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae5121189b424aab9c743ce87e696d9f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1010&h=606&s=108263&e=png&b=1f1f1f)


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b770108638a46e082becb7552bd3b5b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=622&h=288&s=15357&e=png&b=ffffff)

这个墙的选中效果，我们暂时也用不到，去掉：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7133b7ad4d9e43abb97f2068b646281c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1548&h=1076&s=199992&e=png&b=1f1f1f)


>案例代码上传了[小册仓库](https://github.com/QuarkGluonPlasma/threejs-course-code/tree/main/home-decoration-editor)

## 总结

这节我们加上了家具信息编辑的表单。

选中家具的时候，用 antd 的 Form 来展示 position、rotation 等信息，角度用 Slider 滑动条。

data 变化的时候，同步修改表单的值。

表单值变化的时候，同步设置到 store。

这样，家具的信息编辑表单就完成了。
