上节把 2D 视图的门窗画了出来：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc8f948365bf4a3faae5fdba74f2a23f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1262&h=1124&s=319779&e=png&b=add9e6)

这节继续来画尺寸：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8aa999091bd5488f8d97e5118918251d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1302&h=1130&s=564989&e=png&b=eef0f1)

首先，可以看到每个房间有不同的名字，并且会有大小。

我们先把这个加上。

很明显这个数据是要加在地板的数据里：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c7cc75e7e73b4f49959543cc38e1fa86~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=706&h=560&s=56956&e=png&b=1f1f1f)

先改下类型，加上 name、size

```javascript
name?: string,
size?: number
```
在 house2.ts 加一下数据：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/495973b3ad4944a091e0895ec4072f6b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=994&h=1332&s=202271&e=png&b=202020)

```javascript
name: '书房',
size: 5.64
```
```javascript
name: '客餐厅',
size: 28.89
```
如何绘制文字呢？

可以用 Sprite + Canvas 来画，但更方便的是直接用 three-spritetext 这个包。

安装下：

```
npm install --save three-spritetext
```

然后 2D 视图绘制地板的时候加一下文字：



![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/add55c4d2cdc4eebbcdb90ec68081e18~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1602&h=1104&s=230441&e=png&b=1f1f1f)

```javascript
const text = new SpriteText(item.name + '\n' + item.size + 'm²', 200);
text.color = 'black';
floor.add(text);
```


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd2a723d54b64818993b27ddfe1f5cee~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1430&h=1092&s=333062&e=png&b=add8e5)

文字出来了，位置如何设置呢？

同样可以通过包围盒来计算中心位置：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5904d0ce32f9420ea14549c2c39b0097~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1516&h=1026&s=191870&e=png&b=1f1f1f)

```javascript
const box3 = new THREE.Box3();
box3.expandByObject(floor);
const center = box3.getCenter(new THREE.Vector3());
text.position.set(center.x, center.y, center.z);

const helper = new THREE.Box3Helper(box3);
floor.add(helper);
```
用包围盒 Box3 计算中心位置，并且用 Box3Helper 把它可视化出来。


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf19ae7267d9449081c2bbca7016819e~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1372&h=1144&s=337055&e=png&b=add9e6)

现在为止就计算出来了，并且包围盒也是对的。

接下来继续做尺寸标注：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8aa999091bd5488f8d97e5118918251d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1302&h=1130&s=564989&e=png&b=eef0f1)

这些尺寸就是墙的宽度，数据里已经有了，我们绘制墙的时候把它加上：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/10642190d0c3444ca81993d68ae55e18~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1586&h=966&s=209872&e=png&b=1f1f1f)

```javascript
const text = new SpriteText(item.width + '', 200);
text.color = 'black';
wall.add(text);
```

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6e4b1d10f5894068ad7633b9110c2851~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1376&h=1072&s=351250&e=png&b=add9e6)

数字出来了，如何定位呢？

很明显，就是墙宽度的一半的位置。


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3b2f47c30d2e4a6583d2bca6c550d61b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1314&h=744&s=156361&e=png&b=1f1f1f)

```javascript
text.position.x = item.width / 2;
text.position.y = 500;
text.position.z = -100;
```
定位到墙的中间，往上移动 100 像素，然后再离墙远一点。


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c83250f137e149df98ed12d2f3399833~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1470&h=1072&s=362682&e=png&b=aed9e6)

这样，标注就做好了。

切换另一个户型看下：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8517a11e6d1e4e139d73d3c2695b2e71~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=910&h=722&s=85018&e=png&b=1f1f1f)

```javascript
name: '主卧',
size: 35
```

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/37f3cf8ae0b44c04a08cb87499f6c516~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1408&h=1086&s=545261&e=png&b=add9e6)

没啥问题。

我们还可以加上一些线来表示尺寸标识的是哪：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2751a0182d44432780d3a4e7d2671bd3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1584&h=1042&s=250454&e=png&b=1f1f1f)

```javascript
const bufferGeometry = new  THREE.BufferGeometry();
bufferGeometry.setFromPoints([
    new THREE.Vector3(0, 0, 0),
    new THREE.Vector3(item.width, 0, 0),
]);
const lineMaterial = new THREE.LineBasicMaterial({color: '#111'});
const line = new THREE.Line(bufferGeometry, lineMaterial);
wall.add(line);
line.position.z = -100;
line.position.y = 500;
```
用 Line 和 BufferGeometry 来画线，指定首尾两个点就可以了。

看下效果：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f3bf3cd969a5413d897ca1e62ec6a289~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1340&h=870&s=537476&e=png&b=add9e6)

线是画对了，但我们不想让线穿过文字怎么办呢？

可以用线段 LineSegments：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/909761111c4b4210a2cd628596a94787~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1432&h=834&s=188700&e=png&b=1f1f1f)

```javascript
bufferGeometry.setFromPoints([
    new THREE.Vector3(0, 0, 0),
    new THREE.Vector3(item.width / 2 - 300, 0, 0),
    new THREE.Vector3(item.width / 2  + 300, 0, 0),
    new THREE.Vector3(item.width, 0, 0),
]);
const lineMaterial = new THREE.LineBasicMaterial({color: '#111'});
const line = new THREE.LineSegments(bufferGeometry, lineMaterial);
```
LineSegments 是两两相连，我们中间加两个点。


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a8a5ee4c95a466389eb3d61d644cfba~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1162&h=828&s=532197&e=png&b=add9e6)

这样就把文字的地方留出来了。

还可以在首尾加一条竖着的线：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d789d837ce44d7c951ad4388ba6bb9a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1288&h=892&s=221221&e=png&b=1f1f1f)

```javascript
bufferGeometry.setFromPoints([
    new THREE.Vector3(0, -100, 0),
    new THREE.Vector3(0, 100, 0),
    new THREE.Vector3(0, 0, 0),
    new THREE.Vector3(item.width / 2 - 300, 0, 0),
    new THREE.Vector3(item.width / 2  + 300, 0, 0),
    new THREE.Vector3(item.width, 0, 0),
    new THREE.Vector3(item.width, -100, 0),
    new THREE.Vector3(item.width, 100, 0),
]);
```
看下效果：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8db70ebcaeb418596124a264825909d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1284&h=880&s=536840&e=png&b=add9e6)

这样就好多了。

不过这俩标注在地板上了：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2218b37312874366bf636ed36f98c550~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1210&h=814&s=532268&e=png&b=aed9e6)

这个调整下墙的旋转角度就好了：

比如第一面墙：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0eda6a0956d64b5db51c89fd8b999999~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=966&h=626&s=83497&e=png&b=1f1f1f)


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33bbdd2f18034a40acd87e5d34d46851~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1584&h=1332&s=559838&e=png&b=add9e6)

这样方向就对了。

不过位置得调一下：

```javascript
import type { State } from ".";

const data: State['data'] = {
    walls: [
        {
            position: { x: 5000, y: 0, z: 200},
            width: 5000,
            height:3000,
            depth: 200,
            rotationY: Math.PI,
            normal: { x: 0, y: 0, z: 1},
            windows: []
        },
        {
            position: { x: 0, y: 0, z: 7000},
            width: 5000,
            height: 3000,
            depth: 200,
            normal: { x: 0, y: 0, z: -1},
            windows: []
        },
        {
            position: { x: 0, y: 0, z: 0},
            width: 7200,
            height: 3000,
            depth: 200,
            rotationY: -Math.PI / 2,
            normal: { x: 1, y: 0, z: 0},
            windows: [
                    {
                        leftBottomPosition: {
                            left: 2867,
                            bottom: 900
                        },
                        width: 2100,
                        height: 1620
                    }
            ]
        },
        {
            position: { x: 4800, y: 0, z: 7000},
            width: 7000,
            height: 3000,
            depth: 200,
            rotationY: Math.PI / 2,
            normal: { x: -1, y: 0, z: 0},
            windows: [],
            doors: [
                {
                    leftBottomPosition: {
                        left: 6084,
                        bottom: 0
                    },
                    width: 856,
                    height: 2152
                }
            ]
        },
    ],
    floors: [
        {
            points: [
                { x: 0, z: 0},
                { x: 0, z: 6800},
                { x: 4800, z: 6800},
                { x: 4800, z: 0},
                { x: 0, z: 0 }
            ],
            name: '主卧',
            size: 35
        }
    ],
    ceilings: [
        {
            points: [
                { x: 0, z: 0},
                { x: 0, z: 7000},
                { x: 5000, z: 7000},
                { x: 5000, z: 0},
                { x: 0, z: 0 }
            ],
            height: 3000
        }
    ]
};

export default data;
```
我们统一改了一下数据。


![2025-06-27 17.46.23.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4bb18f92219b4d4291f45f8b96aed349~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=19461866&e=gif&f=39&b=a3d1e2)

现在就对了。

不过这里反过来了，再旋转下：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c6f3cc25abca40f294f4da470e9505e9~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1150&h=894&s=538699&e=png&b=add9e6)


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f38a2640a8374cd49bda36fa6aa5b291~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=968&h=494&s=112302&e=png&b=1f1f1f)

```javascript
doorLogo.rotateX(Math.PI);
doorLogo.position.y = 200;
```

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d18863a31084cacb73343f1bf3798e4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1294&h=916&s=542484&e=png&b=aed9e6)

另一个户型的数据也得同样改一下：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55dd5f643df542f0a344ae5948fe5c27~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1516&h=1178&s=377968&e=png&b=add9e6)

现在也是很多墙是反的。

调整好的数据是这样的：

```javascript
import type { State } from ".";

const data: State['data'] = {
    walls: [
        {
            position: { x: 2800, y: 0, z: 200},
            width: 2800,
            height: 3000,
            depth: 200,
            windows: [],
            rotationY: Math.PI,
            normal: { x: 0, y: 0, z: 1},
            doors: [
                {
                    leftBottomPosition: {
                        left: 1680,
                        bottom: 0
                    },
                    width: 1000,
                    height: 2000
                }
            ]
        },
        {
            position: { x: 0, y: 0, z: 0},
            width: 5000,
            height: 3000,
            depth: 200,
            normal: { x: 1, y: 0, z: 0},
            rotationY: -Math.PI / 2,
            windows: []
        },
        {
            position: { x: 0, y: 0, z: 5200},
            width: 5000,
            height: 3000,
            depth: 200,
            rotationY: Math.PI,
            normal: { x: 0, y: 0, z: 1},
            windows: []
        },
        {
            position: { x: -5000, y: 0, z: 5000},
            width: 1880,
            height: 3000,
            depth: 200,
            normal: { x: 1, y: 0, z: 0},
            rotationY: -Math.PI / 2,
            windows: []
        },
        {
            position: { x: -5200, y: 0, z: 6880},
            width: 3000,
            height: 3000,
            depth: 200,
            normal: { x: 0, y: 0, z: -1},
            windows: [
                {
                    leftBottomPosition: {
                        left: 830,
                        bottom: 900
                    },
                    width: 1200,
                    height: 1400
                },
            ]
        },
        {
            position: { x: -2000, y: 0, z: 6880},
            width: 1580,
            height: 3000,
            depth: 200,
            rotationY: -Math.PI / 2,
            normal: { x: 1, y: 0, z: 0},
            windows: []
        },
        {
            position: { x: -2200, y: 0, z: 8260},
            width: 2880,
            height: 3000,
            depth: 200,
            normal: { x: 0, y: 0, z: -1},
            windows: [
                {
                    leftBottomPosition: {
                        left: 355,
                        bottom: 0
                    },
                    width: 2140,
                    height: 2400
                },
            ]
        },
        {
            position: { x: 680, y: 0, z: 8480},
            width: 1380,
            height: 3000,
            depth: 200,
            rotationY: Math.PI / 2,
            normal: { x: -1, y: 0, z: 0},
            windows: []
        },
        {
            position: { x: 880, y: 0, z: 7080},
            width: 2000,
            height: 3000,
            depth: 200,
            normal: { x: 0, y: 0, z: -1},
            windows: []
        },
        {
            position: { x: 2680, y: 0, z: 7080},
            width: 7100,
            height: 3000,
            depth: 200,
            rotationY: Math.PI / 2,
            normal: { x: -1, y: 0, z: 0},
            windows: [
                {
                    leftBottomPosition: {
                        left: 1200,
                        bottom: 900
                    },
                    width: 790,
                    height: 1400
                },
                {
                    leftBottomPosition: {
                        left: 3680,
                        bottom: 900
                    },
                    width: 3000,
                    height: 1400
                }
            ]
        },
    ],
    floors: [
        {
            points: [
                { x: -2000, z: 5000},
                { x: -5000, z: 5000},
                { x: -5000, z: 6680},
                { x: -2000, z: 6680},
                { x: -2000, z: 5000},
            ],
            name: '书房',
            size: 5.64
        },
        {
            points: [
                { x: 0, z: 0},
                { x: 2680, z: 0},
                { x: 2680, z: 6900},
                { x: 680, z: 6900},
                { x: 680, z: 8050},
                { x: -2000, z: 8050},
                { x: -2000, z: 6680},
                { x: -2000, z: 5000},
                { x: -2000, z: 5000},
                { x: 0, z: 5000},
                { x: 0, z: 0},
            ],
            textureUrl: './floor-texture2.png',
            name: '客餐厅',
            size: 28.89
        }
    ],
    ceilings: [
        {
            points: [
                { x: -2000, z: 5200},
                { x: -5000, z: 5200},
                { x: -5000, z: 7000},
                { x: -2000, z: 7000},
                { x: -2000, z: 5200},
            ],
            height: 3000
        },
        {
            points: [
                { x: 0, z: 0},
                { x: 2880, z: 0},
                { x: 2880, z: 7180},
                { x: 880, z: 7180},
                { x: 880, z: 8380},
                { x: -2000, z: 8380},
                { x: -2000, z: 6880},
                { x: -2000, z: 5000},
                { x: -2000, z: 5000},
                { x: 0, z: 5000},
                { x: 0, z: 0},
            ],
            height: 3000
        }
    ]
};

export default data;
```
看下效果：


![2025-06-27 18.04.44.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/827c39417e2e4291893703581e8b11fe~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=14981874&e=gif&f=49&b=a3d0e0)

这样，尺寸标注功能就完成了。

>案例代码上传了[小册仓库](https://github.com/QuarkGluonPlasma/threejs-course-code/tree/main/home-decoration-editor)


## 总结

这节我们加上了尺寸标注功能。

首先是房间的标注，我们把数据存在地板数据上，用包围盒计算地板的中心位置，然后用 SpriteText 加文字。

尺寸的标注是加在墙上，并且我们用线段 LineSegments 加了尺寸范围的标明。

不过有的墙是反着的，导致标注的位置也是反着，我们统一修改了下数据，把墙都翻转朝向外面了。

标注完成后，下节我们开始做户型切换、家具导入。
