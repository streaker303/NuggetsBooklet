上节实现了尺寸标注：

![2025-06-27 18.04.44.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/827c39417e2e4291893703581e8b11fe~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=14981874&e=gif&f=49&b=a3d0e0)

这节我们开始做户型切换、家具的导入和编辑。

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e1aad4e1fe8d44038daf3323be252473~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2152&h=1560&s=1194310&e=png&b=f4f4f4)

我们把左侧的菜单分为两个列表，一个是户型列表，可以切换户型，一个是家具列表，可以导入家具。

用 antd 的 [Segmented](https://ant.design/components/segmented-cn) 组件：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c28b2bd544ff4259be5d311154f48f14~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1466&h=790&s=74638&e=png&b=fefefe)

改下 components/Menu/index.tsx

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3abd093157c441e89dc40ef7306ae8bd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1450&h=1386&s=214877&e=png&b=1f1f1f)

Segmented 的options 里是这两个选项对应的 label 和值。

用一个状态保存 key，Segmented 的onChange 里 setKey

当 key 为户型和家具的时候，分别展示不同的内容。

这里还用到了 @ant-design/icons 的 icon

安装下：

```
npm install --save @ant-design/icons
```
```javascript
import { HomeOutlined, UngroupOutlined } from "@ant-design/icons";
import { Segmented } from "antd";
import { useState } from "react";

function Menu() {

    const [left, setLeft] = useState(0);

    const [key, setKey] = useState('户型');

    return <div className="Menu" style={{left: left}}>
        <Segmented value={key} onChange={setKey} block options={[
            {
                label: <div>
                    <HomeOutlined />
                    <span style={{padding: 10}}>户型</span>
                </div>,
                value: '户型',
            },
            {
                label: <div>
                    <UngroupOutlined />
                    <span style={{padding: 10}}>家具</span>
                </div>,
                value: '家具',
            },
        ]} />
        {
            key === '户型' ? <div>
                111
            </div> : null
        }
        { key === '家具' ? <div>
                222
            </div> : null
        }
        <div className="drawer-bar" onClick={() => {
            setLeft(left === 0 ? -300 : 0);
        }}></div>
    </div>
}

export default Menu;
```

顺便把样式里的背景色改成白色：

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ba8d7b734324098b7527c824b39dca9~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=926&h=720&s=89197&e=png&b=1f1f1f)

看下效果：

![2025-06-27 21.13.09.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/afe57c8dd12341fba6e13e0ef1dd9b41~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=269855&e=gif&f=24&b=a5d1e1)

然后写一下户型列表：

现在只有两个户型：


![house1.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/32318ae770b043309222254ddb7c3751~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1132&h=832&s=432440&e=png&b=acd8e5)

![house2.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/753c022ef27241c48c473abb48110728~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1302&h=1106&s=274728&e=png&b=add9e6)

把这两张图放到 public 目录下：

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d39a63506f764dccb4d7ee59101eedde~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1790&h=1208&s=894849&e=png&b=1c1c1c)

然后写一下家具列表：

用 antd 的 Card 组件：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ccedc6601f6480e9ad9660a5a879501~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1560&h=1300&s=196070&e=png&b=1f1f1f)

```javascript
import { Card, Image, Segmented } from "antd";
```
```javascript
{
    key === '户型' ? <div>
        <Card
            hoverable
            style={{ width: 200, margin: 20 }}
            cover={<Image
                width={200}
                src="./house1.png"
            />}
        >
            <Meta title="1室1厅0厨0卫" description="" />
        </Card>
        <Card
            hoverable
            style={{ width: 200, margin: 20 }}
            cover={<Image
                width={200}
                src="./house2.png"
            />}
        >
            <Meta title="1室2厅0厨0卫" description="" />
        </Card>
    </div> : null
}
```

![2025-06-27 21.25.51.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1724cb69c40f4d68a350a0e2206ee526~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=2091501&e=gif&f=37&b=a5d1e1)

然后点击的时候清空当前户型数据，设置为新的户型。

酷家乐里也是这样：

![2025-06-27 21.27.09.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c3a1129897e84600adeee44cbaf57525~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=1144760&e=gif&f=26&b=d0b9a7)

切换户型会清空当前数据。

我们给 store 添加一个方法：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78b6cad16ef44a319a7907caf33c5142~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1246&h=1060&s=130925&e=png&b=1f1f1f)

这里要添加一个 Action 类型，然后 setData 里返回新的 state。

```javascript
export interface Action {
    setData(data: State['data']): void;
}

const useHouseStore = create<State & Action>((set, get) => {
    return {
        data: data,
        setData(data) {
            set(state => {
                return {
                    ...state,
                    data: data
                }
            })
        }
    }
});
```
在 Menu 组件里点击户型的时候调用 setData：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1cabfa8441784cf4b9e7bfa24a7f5425~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1100&h=720&s=136171&e=png&b=1f1f1f)


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7e7b85f5afaf4048bc55ef9a1f4d91c1~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1352&h=1204&s=193608&e=png&b=202020)

```javascript
import data1 from "../../store/house1";
import data2 from "../../store/house2";
```
```javascript
const {setData} = useHouseStore();
```
```javascript
onClick={() => setData(data1)}
```
```javascript
onClick={() => setData(data2)}
```

试下效果：

![2025-06-27 21.40.24.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3faec526dbf4420bfcfca02a6003afb~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=1667707&e=gif&f=40&b=a6d2e2)

新的户型数据确实设置好了，但之前的场景没清空。

我们处理下：


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf06139e729e4ff0a4d1f2ec7f3fe740~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=882&h=506&s=85955&e=png&b=1f1f1f)


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/34044132a521479895b31477e95e7168~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1006&h=538&s=104463&e=png&b=1f1f1f)

```javascript
house.name = 'house';
```
给两个场景的 hosue 加个 name。

然后 data 变化的时候把 house 删掉：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33133ab9773d486394ab5e1d988e1c0a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1246&h=1298&s=219480&e=png&b=1f1f1f)

```javascript
useEffect(() => {
    const scene1 = scene2DRef.current;
    const scene2 = scene3DRef.current;
    const house1 = scene1?.getObjectByName('house');
    const house2 = scene2?.getObjectByName('house');

    house1?.parent?.remove(house1);
    house2?.parent?.remove(house2);

    house1?.traverse(item => {
        let obj = item as THREE.Mesh;
        if(obj.isMesh) {
            obj.geometry.dispose();
        }
    })
}, [data])
```

根据 name 查找到 house，把它删掉，并且遍历释放所有 geometry 的 gpu 资源。

试下效果：


![2025-06-27 23.12.33.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d43ecd216c946fabef8d81415ac21c7~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=3329042&e=gif&f=44&b=f4f4f4)

有一个问题，重新渲染之后，模型不会重新加载：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe1affb65e9a4890a49fe87a507552d3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2004&h=1216&s=1293009&e=png&b=f3f3f3)

去掉之前的缓存逻辑，每次重新加载就好了：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eabe8628f5e94dffbdbbf59806d238bd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1080&h=1198&s=188252&e=png&b=1f1f1f)


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/806e2635cc854ad4b820212e8bfd28ce~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=986&h=1164&s=178883&e=png&b=1f1f1f)

```javascript
async function loadWindow() {
    const group = new THREE.Group();
    const loader = new GLTFLoader();
    const gltf = await loader.loadAsync("./window.glb");
    group.add(gltf.scene);
    
    const box = new THREE.Box3();
    box.expandByObject(gltf.scene);

    const size = box.getSize(new THREE.Vector3());
    return {
        model: group,
        size
    };
}

async function loadDoor() {
    const group = new THREE.Group();
    const loader = new GLTFLoader();
    const gltf = await loader.loadAsync("./door.glb");
    group.add(gltf.scene);
    
    const box = new THREE.Box3();
    box.expandByObject(gltf.scene);

    const size = box.getSize(new THREE.Vector3());
    return {
        model: group,
        size
    }
}

```

![2025-06-27 23.18.25.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/915105fd7d1f47758f45b64a0b5af160~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=4649831&e=gif&f=44&b=f5f5f5)

最后我们还要加一个提醒：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dae501d822204f7ba4d9594678d13b5a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2202&h=1068&s=1026327&e=png&b=544c46)


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fcdc12ae4f164fd9b67e0ac151fc6c32~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1436&h=1078&s=171156&e=png&b=1f1f1f)

用 antd 的 PopConfirm 组件来实现。

```javascript
{
    key === '户型' ? <div>
        <Popconfirm
            title="提醒"
            description="切换户型将清空数据，是否继续？"
            onConfirm={() => setData(data1)}
            okText="是"
            cancelText="否"
        >
            <Card
                hoverable
                style={{ width: 200, margin: 20 }}
                cover={<Image
                    width={200}
                    src="./house1.png"
                />}
            >
                <Meta title="1室1厅0厨0卫" description="" />
            </Card>
        </Popconfirm>

        <Popconfirm
            title="提醒"
            description="切换户型将清空数据，是否继续？"
            onConfirm={() => setData(data2)}
            okText="是"
            cancelText="否"
        >
            <Card
                hoverable
                style={{ width: 200, margin: 20 }}
                cover={<Image
                    width={200}
                    src="./house2.png"
                />}
            >
                <Meta title="1室2厅0厨0卫" description="" />
            </Card>
        </Popconfirm>
    </div> : null
}
```
试一下：

![2025-06-27 23.22.54.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c81dece9d984ed2bcd84bff69c5895d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=4520770&e=gif&f=50&b=f7f7f7)

这样，户型列表和切换就做好了。

最后我们解决下这个的位置问题：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc08b4b0ab09437087f4da55cd67d5f3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1090&h=890&s=534230&e=png&b=8bceeb)

把 left 改为 320px：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/29ed7ec94dbd4e2999bf82fb2b6f91b9~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=850&h=610&s=74868&e=png&b=1f1f1f)


试一下：


![2025-06-27 23.22.54.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72de13c3e9994dc7ac32db5429042117~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2362&h=1398&s=4520770&e=gif&f=50&b=f7f7f7)

>案例代码上传了[小册仓库](https://github.com/QuarkGluonPlasma/threejs-course-code/tree/main/home-decoration-editor)


## 总结

这节我们实现了户型切换。

首先我们用 Segmented、Card 组件实现了户型列表的布局，点击的时候修改 store 里的数据来实现户型切换。

需要注意的是切换户型的时候，要找到之前 house 对象，把它删掉。

户型列表和切换实现后，下节就可以来做家具列表和家具导入了。