上节实现了删除：

![2025-07-30 20.29.38.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1234b70f7d9445abb0de6b6e1f1e21b8~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=873809&e=gif&f=30&b=f4f4f4)

但还有一些问题：


![2025-07-31 09.47.56.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d7bca1f3f1a4475a6a778ed0d455790~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=6016045&e=gif&f=40&b=f7f7f7)

我在 3D 场景中把床删了，但其余场景的还在，需要刷新才可以。

我们先来加一下 2D 场景的删除：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e86cf04dba4c4cc6b1957c403f442c15~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1812&h=1124&s=248007&e=png&b=1f1f1f)

```javascript
const scene2D = scene2DRef.current!;
```
```javascript
const furniture2D = scene2D.getObjectByName(curSelectedFurniture.id);
if(furniture2D) {
    furniture2D.parent?.remove(furniture2D);
}
```
同样的方式在 2D 场景中查找并删除这个家具。


![2025-07-31 10.00.18.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07d851900bfd4280a26a546137733d76~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=1620683&e=gif&f=43&b=f4f4f4)

这样 3D 场景里删了 2D 场景就没有了。

但同样需要处理 TransformControls 的问题：


![2025-07-31 10.02.03.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8bb774a5df964700ac40a943bf482dcf~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=1444624&e=gif&f=32&b=abd4e3)

导出下 detach 方法：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f012ae60f246467b85bd01a6fe421d35~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=914&h=724&s=98907&e=png&b=1f1f1f)

```javascript
function detachTransformControls() {
    transformControls.detach();
}
```
组件里接收下：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec0defd543ff47d0b444d66ff2b5aa8c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1484&h=680&s=233560&e=png&b=1f1f1f)

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b032062643964cb89a80017b120afee5~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1614&h=758&s=161768&e=png&b=1f1f1f)

```javascript
const detachTransformControls2DRef = useRef<() => void>(null);
```
```javascript
detachTransformControls2DRef.current = detachTransformControls;
```
删除的时候调用下：


![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aec5a8025d1b4f8c96c16fee563f3d96~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1556&h=752&s=160689&e=png&b=1f1f1f)

```javascript
detachTransformControls2DRef.current?.();
```
试试效果：


![2025-07-31 10.08.07.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90d6fa6b819f40a0b074fa5e6259a4c0~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=907946&e=gif&f=24&b=f5f5f5)

搞定。

然后是预览场景：


![2025-07-31 10.09.11.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fcb8c1986a984a79bfa872c716991b1d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=3456057&e=gif&f=31&b=f4f4f4)

监听 data.furnitures 数组的长度变化就可以了：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7614ec5669e747cbb083eef9b7f62a98~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1424&h=796&s=157053&e=png&b=1f1f1f)

```javascript
useEffect(() => {
    const scene = scene3DRef.current!;

    const furnitureGroup = scene.getObjectByName('furnitures');

    furnitureGroup?.children.forEach(item => {
        if(!data.furnitures.find(f => f.id === item.name)) {
            item.parent?.remove(item);
        }
    })
}, [data.furnitures.length])
```
如果场景中的家具没有对应的数据，那就删除。

试下效果：


![2025-07-31 10.16.16.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f44841c87da24a47aee4ddebf36dfdec~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2820&h=1540&s=7967474&e=gif&f=32&b=f2f2f2)

这样就好了。

>案例代码上传了[小册仓库](https://github.com/QuarkGluonPlasma/threejs-course-code/tree/main/home-decoration-editor)

## 总结

这节我们修复了下删除时另外两个场景没有同步的问题。

首先用同样的方式在删除的时候把 2D 场景中的家具也删除，并且把 TransformControls 给 detach。

然后预览场景中监听 data 中家具数组的长度变化，长度变了就遍历所有家具，没有在 data 中的就删除。

这样，删除家具功能的三个场景同步删除就完成了。
